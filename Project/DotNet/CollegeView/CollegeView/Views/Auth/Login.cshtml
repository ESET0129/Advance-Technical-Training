
@{
    ViewData["Title"] = "Login";
}

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

<div class="container d-flex justify-content-center align-items-center vh-100">
    <div class="card shadow-lg p-4" style="width: 400px; border-radius: 15px;">
        <h3 class="text-center mb-4 text-primary">🔐 User Login</h3>

        <div class="form-group mb-3">
            <label for="userId" class="form-label fw-semibold">User ID</label>
            <input type="text" id="userId" class="form-control" placeholder="Enter User ID" />
        </div>

        <div class="form-group mb-4">
            <label for="password" class="form-label fw-semibold">Password</label>
            <input type="password" id="password" class="form-control" placeholder="Enter password" />
        </div>

        <div class="d-grid">
            <button id="btnLogin" class="btn btn-primary btn-lg">
                <i class="bi bi-box-arrow-in-right"></i> Login
            </button>
        </div>

        <p id="msg" class="mt-3 text-center fw-bold"></p>
    </div>
</div>

<!-- Bootstrap & jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Bootstrap Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<script>
    $("#btnLogin").click(function () {
        var user = {
            userId: $("#userId").val(),  // Changed from username to userId
            password: $("#password").val()
        };

        // Basic validation
        if (!user.userId || !user.password) {
            $("#msg").text("Please enter both User ID and Password").addClass("text-danger");
            return;
        }

        $.ajax({
            url: "https://localhost:7142/api/Auth/login", // Updated to match your CollegeApp URL
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(user),
            success: function (response) {
                // Store token and user info
                localStorage.setItem("jwtToken", response.token);
                if (response.user) {
                    localStorage.setItem("userInfo", JSON.stringify(response.user));
                }

                $("#msg").text("Login successful!").removeClass("text-danger").addClass("text-success");

                // Redirect to Courses page after successful login
                setTimeout(function() {
                    window.location.href = "/Course/CourseView";
                }, 1000);
            },
            error: function (xhr) {
                if (xhr.status === 401) {
                    $("#msg").text("Invalid User ID or Password").addClass("text-danger");
                } else if (xhr.status === 400) {
                    $("#msg").text("User ID and Password are required").addClass("text-danger");
                } else {
                    $("#msg").text("Login failed. Please try again.").addClass("text-danger");
                }
            }
        });
    });

    // Allow login on Enter key press
    $("#userId, #password").keypress(function (e) {
        if (e.which == 13) {
            $("#btnLogin").click();
        }
    });

    // Clear error message when user starts typing
    $("#userId, #password").on('input', function() {
        $("#msg").text("").removeClass("text-danger text-success");
    });
</script>












@* 
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const token = sessionStorage.getItem("jwtToken"); // Changed to sessionStorage

        if (token) {
            // Logged in
            document.getElementById("nav-student").classList.remove("d-none");
            document.getElementById("nav-course").classList.remove("d-none");
            document.getElementById("nav-login").classList.add("d-none");
            document.getElementById("user-profile").classList.remove("d-none");

            // Extract user info from JWT token (if available)
            try {
                const payload = JSON.parse(atob(token.split('.')[1]));
                if (payload.unique_name) {
                    document.getElementById("user-name").textContent = payload.unique_name;
                }
                if (payload.role) {
                    document.getElementById("user-role").textContent = payload.role;
                }
            } catch (e) {
                console.log("Could not extract user info from token");
            }
        } else {
            // Logged out
            document.getElementById("nav-student").classList.add("d-none");
            document.getElementById("nav-course").classList.add("d-none");
            document.getElementById("nav-login").classList.remove("d-none");
            document.getElementById("user-profile").classList.add("d-none");
        }
    });

    function logout() {
        sessionStorage.removeItem("jwtToken"); // Changed to sessionStorage
        sessionStorage.removeItem("userInfo"); // Also remove userInfo if stored
        window.location.href = "/Auth/Login";
    }
</script> *@